<!-- features/character-creation/steps/languages-step/languages-step.component.html -->
<div class="languages-step">
  <h2>Langues connues</h2>
  <p class="step-description">
    Vos langues sont dÃ©terminÃ©es par votre espÃ¨ce et votre civilisation. @if (languageChoicesCount >
    0) { Vous pouvez Ã©galement choisir <strong>{{ languageChoicesCount }}</strong> langue(s)
    supplÃ©mentaire(s). }
  </p>

  @if (loading) {
  <div class="loading">Chargement des langues...</div>
  } @else {
  <!-- Langues fixes -->
  @if (fixedLanguages.length > 0) {
  <div class="fixed-languages">
    <h3>ðŸ“œ Langues automatiques</h3>
    <p class="section-description">
      Ces langues sont acquises grÃ¢ce Ã  votre espÃ¨ce et civilisation.
    </p>
    <div class="languages-tags">
      @for (lang of fixedLanguages; track lang) {
      <span class="language-tag fixed">
        <span class="tag-icon">{{ getLanguageIcon(lang) }}</span>
        {{ lang }}
      </span>
      }
    </div>

    <div class="sources">
      <div class="source">
        <span class="source-label">EspÃ¨ce</span>
        <span class="source-value">
          {{
            filterNonChoiceLanguages(creationService.character().speciesLanguages).join(', ') ||
              'Aucune'
          }}
        </span>
      </div>
      <div class="source">
        <span class="source-label">Civilisation</span>
        <span class="source-value">
          {{
            filterNonChoiceLanguages(creationService.character().civilizationLanguages).join(
              ', '
            ) || 'Aucune'
          }}
        </span>
      </div>
    </div>
  </div>
  }

  <!-- Choix de langues -->
  @if (languageChoicesCount > 0) {
  <div class="language-choices">
    <h3>ðŸŽ¯ Choisissez vos langues</h3>
    <p class="section-description">
      SÃ©lectionnez <strong>{{ languageChoicesCount }}</strong> langue(s) supplÃ©mentaire(s).
    </p>

    <div class="selection-counter" [class.complete]="isStepComplete()">
      <span class="counter-label">SÃ©lectionnÃ©es</span>
      <span class="counter-value">
        {{ selectedChoiceLanguages.length }} / {{ languageChoicesCount }}
      </span>
      @if (isStepComplete()) {
      <span class="counter-check">âœ“</span>
      }
    </div>

    <div class="cards-grid">
      @for (lang of getAvailableLanguagesForChoice(); track lang) {
      <app-selection-card
        [icon]="getLanguageIcon(lang)"
        [title]="lang"
        [selected]="isLanguageSelected(lang)"
        [disabled]="!isLanguageSelected(lang) && !canSelectMore()"
        (cardClick)="toggleLanguage(lang)"
      />
      }
    </div>

    <!-- Langues choisies -->
    @if (selectedChoiceLanguages.length > 0) {
    <div class="chosen-languages">
      <h4>Langues choisies</h4>
      <div class="languages-tags">
        @for (lang of selectedChoiceLanguages; track lang) {
        <span class="language-tag chosen">
          <span class="tag-icon">{{ getLanguageIcon(lang) }}</span>
          {{ lang }}
          <button class="remove-btn" (click)="toggleLanguage(lang)">âœ•</button>
        </span>
        }
      </div>
      <button class="clear-btn" (click)="clearChoices()">ðŸ”„ RÃ©initialiser</button>
    </div>
    }
  </div>
  }

  <!-- RÃ©sumÃ© final -->
  <div class="final-summary">
    <h3>ðŸ“š Toutes vos langues</h3>
    <div class="languages-tags">
      @for (lang of fixedLanguages; track lang) {
      <span class="language-tag final">
        <span class="tag-icon">{{ getLanguageIcon(lang) }}</span>
        {{ lang }}
        <span class="tag-source">(auto)</span>
      </span>
      } @for (lang of selectedChoiceLanguages; track lang) {
      <span class="language-tag final chosen">
        <span class="tag-icon">{{ getLanguageIcon(lang) }}</span>
        {{ lang }}
        <span class="tag-source">(choix)</span>
      </span>
      }
    </div>
    <p class="total-count">
      Total :
      <strong>{{ fixedLanguages.length + selectedChoiceLanguages.length }}</strong> langue(s)
    </p>
  </div>
  }
</div>
