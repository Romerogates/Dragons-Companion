<div class="step-container">
  <div class="step-header">
    <h2>Langues connues</h2>
    <p class="step-description">
      Vos langues sont dÃ©terminÃ©es par votre espÃ¨ce et votre civilisation. @if (languageChoicesCount
      > 0) { Vous pouvez Ã©galement choisir <strong>{{ languageChoicesCount }}</strong> langue(s)
      supplÃ©mentaire(s). }
    </p>
  </div>

  @if (loading) {
  <div class="loading-state">
    <div class="spinner"></div>
    <span>Chargement des langues...</span>
  </div>
  } @else { @if (fixedLanguages.length > 0) {
  <div class="fixed-section">
    <div class="section-header">
      <span class="icon">ðŸ“œ</span>
      <div class="header-text">
        <h3>Langues natives</h3>
        <p>Ces langues sont acquises automatiquement grÃ¢ce Ã  votre espÃ¨ce et civilisation.</p>
      </div>
    </div>

    <div class="languages-tags">
      @for (lang of fixedLanguages; track lang) {
      <span class="language-tag fixed">
        <span class="tag-icon">{{ getLanguageIcon(lang) }}</span>
        {{ lang }}
      </span>
      }
    </div>

    <div class="sources-grid">
      <div class="source-item">
        <span class="source-label">EspÃ¨ce</span>
        <span class="source-value">
          {{
            filterNonChoiceLanguages(creationService.character().speciesLanguages).join(', ') ||
              'Aucune'
          }}
        </span>
      </div>
      <div class="source-item">
        <span class="source-label">Civilisation</span>
        <span class="source-value">
          {{
            filterNonChoiceLanguages(creationService.character().civilizationLanguages).join(
              ', '
            ) || 'Aucune'
          }}
        </span>
      </div>
    </div>
  </div>
  } @if (languageChoicesCount > 0) {
  <div class="choices-section">
    <div class="section-header">
      <span class="icon">ðŸŽ¯</span>
      <div class="header-text">
        <h3>Langues additionnelles</h3>
        <p>
          SÃ©lectionnez <strong>{{ languageChoicesCount }}</strong> langue(s) supplÃ©mentaire(s) pour
          complÃ©ter votre savoir.
        </p>
      </div>
    </div>

    <div class="selection-counter" [class.complete]="isStepComplete()">
      <span class="counter-label">SÃ©lectionnÃ©es</span>
      <span class="counter-value">
        {{ selectedChoiceLanguages.length }} / {{ languageChoicesCount }}
      </span>
      @if (isStepComplete()) { <span class="counter-check">âœ“</span> }
    </div>

    <div class="cards-grid">
      @for (lang of getAvailableLanguagesForChoice(); track lang) {
      <app-selection-card
        [icon]="getLanguageIcon(lang)"
        [title]="lang"
        [selected]="isLanguageSelected(lang)"
        [disabled]="!isLanguageSelected(lang) && !canSelectMore()"
        (cardClick)="toggleLanguage(lang)"
      >
      </app-selection-card>
      }
    </div>

    @if (selectedChoiceLanguages.length > 0) {
    <div class="chosen-languages-summary">
      <h4>Vos choix :</h4>
      <div class="languages-tags">
        @for (lang of selectedChoiceLanguages; track lang) {
        <span class="language-tag chosen">
          <span class="tag-icon">{{ getLanguageIcon(lang) }}</span>
          {{ lang }}
          <button class="remove-btn" (click)="toggleLanguage(lang)" aria-label="Retirer">âœ•</button>
        </span>
        }
      </div>
      <button class="clear-btn" (click)="clearChoices()">ðŸ”„ RÃ©initialiser</button>
    </div>
    }
  </div>
  }

  <div class="final-summary">
    <h3>ðŸ“š Bilan linguistique</h3>
    <div class="languages-tags">
      @for (lang of fixedLanguages; track lang) {
      <span class="language-tag final">
        <span class="tag-icon">{{ getLanguageIcon(lang) }}</span>
        {{ lang }}
        <span class="tag-source">(Natif)</span>
      </span>
      } @for (lang of selectedChoiceLanguages; track lang) {
      <span class="language-tag final chosen">
        <span class="tag-icon">{{ getLanguageIcon(lang) }}</span>
        {{ lang }}
        <span class="tag-source">(Appris)</span>
      </span>
      }
    </div>
    <p class="total-count">
      Total :
      <strong>{{ fixedLanguages.length + selectedChoiceLanguages.length }}</strong> langue(s)
      parlÃ©e(s).
    </p>
  </div>
  }
</div>
