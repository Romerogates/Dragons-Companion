<div class="step-container">
  <div class="step-header">
    <h2>Choisissez votre espèce</h2>
    <p class="step-description">
      Votre espèce détermine vos bonus aux caractéristiques, vos traits raciaux et vos langues de
      départ.
    </p>
  </div>

  @if (loading) {
  <div class="loading">Chargement des espèces...</div>
  } @else {
  <div class="species-grid">
    @for (s of speciesList; track s.id) {
    <app-selection-card
      [title]="s.name"
      [icon]="getIcon(s.name)"
      [details]="getSpeciesDetails(s)"
      [selected]="isSpeciesSelected(s.id)"
      (cardClick)="selectSpecies(s)"
    >
    </app-selection-card>
    }
  </div>

  @if (selectedSpeciesDetail && selectedSpeciesDetail.subspecies.length > 0) {
  <div class="subspecies-section">
    <h3>Choisissez votre sous-espèce</h3>
    <p class="section-description">
      Les {{ selectedSpeciesDetail.name }}s ont plusieurs variantes avec des bonus supplémentaires.
    </p>

    <div class="species-grid">
      @for (sub of selectedSpeciesDetail.subspecies; track sub.id) {
      <app-selection-card
        [title]="sub.name"
        [icon]="getIcon(selectedSpeciesDetail.name)"
        [details]="getSubspeciesDetails(sub)"
        [selected]="isSubspeciesSelected(sub.id)"
        (cardClick)="selectSubspecies(sub)"
      >
      </app-selection-card>
      }
    </div>
  </div>
  } @if (creationService.character().speciesId) {
  <div class="selection-summary">
    <h3>✅ Sélection Actuelle</h3>
    <div class="summary-content">
      <div class="summary-main">
        <span class="summary-icon">{{ getIcon(creationService.character().speciesName!) }}</span>
        <div class="summary-info">
          <strong>{{ creationService.character().speciesName }}</strong>
          @if (creationService.character().subspeciesName) {
          <span class="subspecies-label">({{ creationService.character().subspeciesName }})</span>
          }
        </div>
      </div>

      <div class="summary-details">
        <div class="detail-group">
          <span class="detail-label">Total Bonus</span>
          <span class="detail-value bonus">{{
            formatAbilityBonusesString(creationService.character().racialBonuses)
          }}</span>
        </div>
        <div class="detail-group">
          <span class="detail-label">Vitesse</span>
          <span class="detail-value">{{ creationService.character().speciesSpeed }}m</span>
        </div>
        <div class="detail-group">
          <span class="detail-label">Langues</span>
          <span class="detail-value">{{
            creationService.character().speciesLanguages.join(', ')
          }}</span>
        </div>
      </div>

      <button class="clear-btn" (click)="clearSelection()">✕ Réinitialiser</button>
    </div>
  </div>
  } }
</div>
