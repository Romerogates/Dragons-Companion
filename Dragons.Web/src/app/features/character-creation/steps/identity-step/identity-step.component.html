<div class="step-container">
  <div class="step-header">
    <h2>Identit√© du Personnage</h2>
    <p class="step-description">
      Donnez vie √† votre avatar en d√©finissant son nom, son apparence et sa personnalit√©.
    </p>
  </div>

  <div class="form-container">
    <div class="form-section">
      <h3 class="section-title">üåü L'Essentiel</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label for="name">Nom du personnage <span class="required">*</span></label>
          <input
            type="text"
            id="name"
            [ngModel]="creationService.character().name"
            (ngModelChange)="updateIdentity('name', $event)"
            placeholder="Ex: Aragorn, Gandalf..."
            autocomplete="off"
          />
        </div>

        <div class="form-group">
          <label for="alignment">Alignement</label>
          <select
            id="alignment"
            [ngModel]="creationService.character().alignment"
            (ngModelChange)="updateIdentity('alignment', $event)"
          >
            <option value="">-- Choisir un alignement --</option>
            @for (align of alignments; track align) {
            <option [value]="align">{{ align }}</option>
            }
          </select>
        </div>

        <div class="form-group">
          <label for="background">Historique (Background)</label>
          <input
            type="text"
            id="background"
            [ngModel]="creationService.character().background"
            (ngModelChange)="updateIdentity('background', $event)"
            placeholder="Ex: Soldat, Artisan, Ermite..."
          />
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">üëÄ Apparence</h3>
      <div class="form-group full-width">
        <label for="description">Description physique</label>
        <textarea
          id="description"
          [ngModel]="creationService.character().description"
          (ngModelChange)="updateIdentity('description', $event)"
          placeholder="Taille, poids, couleur des yeux, cicatrices, style vestimentaire..."
          rows="3"
        ></textarea>
      </div>

      <div class="form-group full-width">
        <label for="handicap">Particularit√© / Handicap (Optionnel)</label>
        <textarea
          id="handicap"
          [ngModel]="creationService.character().handicap"
          (ngModelChange)="updateIdentity('handicap', $event)"
          placeholder="Si votre personnage a un handicap visible ou une particularit√© physique marquante..."
          rows="2"
        ></textarea>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">üß† Personnalit√©</h3>
      <div class="form-grid personality-grid">
        <div class="form-group">
          <label for="traits">Traits de personnalit√©</label>
          <textarea
            id="traits"
            [ngModel]="creationService.character().traits"
            (ngModelChange)="updateIdentity('traits', $event)"
            placeholder="Comment se comporte-t-il au quotidien ?"
            rows="3"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="ideal">Id√©al</label>
          <textarea
            id="ideal"
            [ngModel]="creationService.character().ideal"
            (ngModelChange)="updateIdentity('ideal', $event)"
            placeholder="Qu'est-ce qui le pousse √† avancer ?"
            rows="3"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="bonds">Obligations / Liens</label>
          <textarea
            id="bonds"
            [ngModel]="creationService.character().bonds"
            (ngModelChange)="updateIdentity('bonds', $event)"
            placeholder="Envers qui ou quoi est-il loyal ?"
            rows="3"
          ></textarea>
        </div>

        <div class="form-group">
          <label for="flaws">Failles / D√©fauts</label>
          <textarea
            id="flaws"
            [ngModel]="creationService.character().flaws"
            (ngModelChange)="updateIdentity('flaws', $event)"
            placeholder="Quelle est sa plus grande faiblesse ?"
            rows="3"
          ></textarea>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h3 class="section-title">üìú √âpop√©e</h3>

      <div class="form-group full-width">
        <label for="story">Le r√©cit de votre personnage</label>
        <textarea
          id="story"
          [ngModel]="creationService.character().story"
          (ngModelChange)="updateIdentity('story', $event)"
          placeholder="D'o√π vient votre personnage ? Qu'a-t-il v√©cu avant de devenir aventurier ? Quels √©v√©nements l'ont marqu√© ?"
          rows="8"
        ></textarea>
      </div>

      <div class="ai-generation">
        <button
          type="button"
          class="generate-btn"
          (click)="generateStory()"
          [disabled]="isGenerating()"
        >
          @if (isGenerating()) {
          <span class="spinner"></span>
          G√©n√©ration en cours... } @else { ‚ú® G√©n√©rer avec l'IA }
        </button>
        <p class="ai-hint">
          L'IA utilisera le nom, l'esp√®ce, la civilisation, la classe et la personnalit√© pour cr√©er
          une √©pop√©e unique.
        </p>
        @if (generationError()) {
        <p class="error-message">{{ generationError() }}</p>
        }
      </div>
    </div>
  </div>
</div>
