<div class="step-container">
  <div class="step-header">
    <h2>üéí √âquipement de d√©part</h2>
    <p class="step-description">
      En tant que <strong>{{ creationService.character().className }}</strong
      >, constituez votre paquetage √©tape par √©tape.
    </p>
  </div>

  @if (isLoading) {
  <div class="loading-state">
    <div class="spinner"></div>
    <span>Chargement de l'arsenal...</span>
  </div>
  } @else {
  <div class="equipment-choices-container">
    @for (choice of getStartingEquipment(); track $index; let i = $index) { @if (i <=
    currentStepIndex) {

    <div
      #choiceContainer
      class="choice-step-wrapper fade-in-up"
      [class.step-active]="i === currentStepIndex"
      [class.step-completed]="i < currentStepIndex"
    >
      @if (isFixedChoice(choice)) {
      <div class="fixed-equipment-card">
        <div class="card-header">
          <span class="icon">üì¶</span>
          <div class="header-text">
            <span class="title">Inclus d'office</span>
            <span class="subtitle">Cet √©quipement est ajout√© automatiquement.</span>
          </div>
          <span class="check-fixed">‚úì</span>
        </div>
        <ul class="items-list">
          @for (item of choice.fixed; track item) {
          <li>
            <span class="item-name">{{ item }}</span>
            @if (getItemInfo(item)) { <span class="item-stats">{{ getItemInfo(item) }}</span> }
          </li>
          }
        </ul>
      </div>

      } @else {
      <div class="choice-group">
        <h4 class="choice-number">Choix {{ i + 1 }}</h4>
        <p class="choice-instruction">S√©lectionnez une option pour continuer :</p>

        <div class="options-grid">
          @if (hasChoice(choice, 'A')) {
          <button
            class="option-card"
            [class.selected]="isChoiceSelected(i, 'A')"
            (click)="selectChoice(i, 'A')"
            aria-label="Choisir l'option A"
          >
            <div class="option-header">
              <span class="option-letter">A</span>
              @if (isChoiceSelected(i, 'A')) { <span class="check">‚úì</span> }
            </div>
            <ul class="option-items">
              @for (item of getChoiceItems(choice, 'A'); track item) {
              <li>
                {{ item }}
                @if (getItemInfo(item)) { <span class="stats">{{ getItemInfo(item) }}</span> }
              </li>
              }
            </ul>
          </button>
          } @if (hasChoice(choice, 'B')) {
          <div class="separator">OU</div>
          <button
            class="option-card"
            [class.selected]="isChoiceSelected(i, 'B')"
            (click)="selectChoice(i, 'B')"
            aria-label="Choisir l'option B"
          >
            <div class="option-header">
              <span class="option-letter">B</span>
              @if (isChoiceSelected(i, 'B')) { <span class="check">‚úì</span> }
            </div>
            <ul class="option-items">
              @for (item of getChoiceItems(choice, 'B'); track item) {
              <li>
                {{ item }}
                @if (getItemInfo(item)) { <span class="stats">{{ getItemInfo(item) }}</span> }
              </li>
              }
            </ul>
          </button>
          } @if (hasChoice(choice, 'C')) {
          <div class="separator">OU</div>
          <button
            class="option-card"
            [class.selected]="isChoiceSelected(i, 'C')"
            (click)="selectChoice(i, 'C')"
            aria-label="Choisir l'option C"
          >
            <div class="option-header">
              <span class="option-letter">C</span>
              @if (isChoiceSelected(i, 'C')) { <span class="check">‚úì</span> }
            </div>
            <ul class="option-items">
              @for (item of getChoiceItems(choice, 'C'); track item) {
              <li>
                {{ item }}
                @if (getItemInfo(item)) { <span class="stats">{{ getItemInfo(item) }}</span> }
              </li>
              }
            </ul>
          </button>
          }
        </div>
      </div>
      }
    </div>
    } }
  </div>

  @if (isAllChoicesMade()) {
  <div class="inventory-summary fade-in-up">
    <h3>üéí Inventaire compl√©t√© !</h3>

    <div class="inventory-grid">
      @for (item of creationService.character().selectedEquipment; track item.name) {
      <div class="inventory-item">
        <div class="item-main">
          <span class="item-name">{{ item.name }}</span>
          @if (item.quantity > 1) { <span class="qty">x{{ item.quantity }}</span> }
        </div>

        <div class="item-meta">
          @if (item.damage) {
          <span class="badge damage">‚öîÔ∏è {{ item.damage }} {{ item.damageType }}</span>
          } @if (item.baseAC) {
          <span class="badge armor">üõ°Ô∏è CA {{ item.baseAC }}</span>
          }
        </div>
      </div>
      }
    </div>
  </div>
  } }
</div>
