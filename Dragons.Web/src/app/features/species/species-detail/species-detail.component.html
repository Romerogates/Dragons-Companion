<div class="species-detail-page">
  <div class="page-header">
    <a routerLink="/compendium/species" class="back-btn">‚Üê Retour √† la liste</a>
  </div>

  @if (loading) {
  <div class="loading">
    <div class="spinner"></div>
    <span>Chargement des donn√©es...</span>
  </div>
  } @else if (species) {
  <header class="species-header-card">
    <div class="icon-wrapper">
      <span class="species-icon">{{ getIcon(species.name) }}</span>
    </div>
    <div class="header-content">
      <h1>{{ species.name }}</h1>
      <div class="badges">
        <span class="badge size">{{ getSizeLabel(species.baseStats.sizeCategory) }}</span>
        <span class="badge speed">{{ species.baseStats.speedMeters }}m</span>
        @if (species.baseStats.hasDarkvision) {
        <span class="badge vision"
          >Vision nuit {{ species.baseStats.darkvisionRadiusMeters }}m</span
        >
        }
      </div>
    </div>
    <div class="header-stats">
      <span class="stat-label">Bonus de base</span>
      <span class="stat-value">{{ formatAbilityBonuses(species.baseStats.abilityBonuses) }}</span>
    </div>
  </header>

  <div class="detail-grid">
    <div class="left-col">
      <section class="detail-card">
        <h2>‚ú® Traits Raciaux</h2>
        <div class="traits-list">
          @for (trait of species.traits; track trait.name) {
          <div class="trait-item">
            <h3>{{ trait.name }}</h3>
            <p>{{ trait.description }}</p>
          </div>
          }
        </div>
      </section>

      <section class="detail-card">
        <h2>üó£Ô∏è Langues Parl√©es</h2>
        <div class="tags-list">
          @for (lang of species.languages; track lang) {
          <span class="tag">{{ lang }}</span>
          }
        </div>
      </section>
    </div>

    <div class="right-col">
      @if (species.subspecies.length > 0) {
      <section class="detail-card subspecies-section">
        <h2>üåø Sous-esp√®ces</h2>
        <p class="section-desc">S√©lectionnez une variante pour voir ses bonus.</p>

        <div class="subspecies-list">
          @for (sub of species.subspecies; track sub.id) {
          <div
            class="subspecies-card"
            [class.active]="selectedSubspecies?.id === sub.id"
            (click)="selectSubspecies(sub)"
          >
            <div class="card-head">
              <span class="radio-circle"></span>
              <h3>{{ sub.name }}</h3>
            </div>

            <div class="card-body">
              <div class="bonus-row">
                <span class="bonus-tag">{{
                  formatAbilityBonuses(sub.additionalStats.abilityBonuses)
                }}</span>
              </div>

              @if (selectedSubspecies?.id === sub.id) {
              <div class="sub-traits fade-in">
                @for (trait of sub.additionalTraits; track trait.name) {
                <div class="mini-trait">
                  <strong>{{ trait.name }}</strong
                  >: {{ trait.description }}
                </div>
                }
              </div>
              }
            </div>
          </div>
          }
        </div>

        @if (selectedSubspecies) {
        <div class="total-summary fade-in">
          <h4>Total Bonus (Base + {{ selectedSubspecies.name }})</h4>
          <div class="big-score">{{ formatAbilityBonuses(getTotalBonuses()) }}</div>
        </div>
        }
      </section>
      } @else {
      <section class="detail-card info-card">
        <h3>‚ÑπÔ∏è Information</h3>
        <p>Cette esp√®ce ne poss√®de pas de sous-esp√®ces connues dans le SRD.</p>
      </section>
      }
    </div>
  </div>
  } @else {
  <div class="error-state">
    <h2>Esp√®ce introuvable</h2>
    <a routerLink="/compendium/species" class="btn btn-primary">Retour √† la liste</a>
  </div>
  }
</div>
